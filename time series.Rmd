---
title: "Time Series Analysis in R"
author: "Andi"
Last updated: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# {r, echo = FALSE, results='hide'}
# if we used both 'echo=TRUE' and 'results=hide' the pipe would not work properly
# if we used 'echo = FALSE' and 'results=hide' we would have only messages (i.e. attaching package) If we don't want them we set 'error = FALSE', 'warning = FALSE', and 'message = FALSE'.
library(dplyr)
```

## Exploring raw time series

```{r}
Nile<-structure(c(1120, 1160, 963, 1210, 1160, 1160, 813, 1230, 1370, 
1140, 995, 935, 1110, 994, 1020, 960, 1180, 799, 958, 1140, 1100, 
1210, 1150, 1250, 1260, 1220, 1030, 1100, 774, 840, 874, 694, 
940, 833, 701, 916, 692, 1020, 1050, 969, 831, 726, 456, 824, 
702, 1120, 1100, 832, 764, 821, 768, 845, 864, 862, 698, 845, 
744, 796, 1040, 759, 781, 865, 845, 944, 984, 897, 822, 1010, 
771, 676, 649, 846, 812, 742, 801, 1040, 860, 874, 848, 890, 
744, 749, 838, 1050, 918, 986, 797, 923, 975, 815, 1020, 906, 
901, 1170, 912, 746, 919, 718, 714, 740), .Tsp = c(1871, 1970, 
1), class = "ts")

# Print the Nile dataset
print(Nile)

# List the number of observations in the Nile dataset
length(Nile)

# Display the first 10 elements of the Nile dataset
head(Nile, 10)

# Display the last 12 elements of the Nile dataset
tail(Nile, 12)
```

## Basic time series plots

```{r}
# Plot the Nile data
plot(Nile)

# Plot the Nile data with xlab and ylab arguments
plot(Nile, xlab = "Year", ylab = "River Volume (1e9 m^{3})")

# Plot the Nile data with xlab, ylab, main, and type arguments
plot(Nile, xlab = "Year", ylab = "River Volume (1e9 m^{3})", main = "Annual River Nile Volume at Aswan, 1871-1970", type = "b")
```

## What does the time index tell us?

```{r, echo=FALSE}
discrete_data <- structure(c(0.479425538604203, 0.841470984807897, 0.997494986604054, 
0.909297426825682, 0.598472144103957, 0.141120008059867, -0.35078322768962, 
-0.756802495307928, -0.977530117665097, -0.958924274663138, -0.705540325570392, 
-0.279415498198926, 0.215119988087816, 0.656986598718789, 0.937999976774739, 
0.989358246623382, 0.79848711262349, 0.412118485241757, -0.0751511204618093, 
-0.54402111088937), .Tsp = c(1, 20, 1), class = "ts")

continuous_series <- c(0.568894675391674, 0.766304082748762, 0.992075122074743, 0.974817414246897, 
0.399123202687807, 0.37660246288782, -0.385320332818421, -0.836358518142533, 
-0.999669829045622, -0.998310189536195, -0.646222799842192, -0.0938615130061447, 
0.400529093874378, 0.681605778899236, 0.953181592214187, 0.996938027205692, 
0.839341938468838, 0.370037544609373, -0.255096756784655, -0.617439825310109
)

continuous_time_index <- c(1.21032244665548, 1.74613730167039, 2.88963444461115, 3.59138367255218, 
5.46206454467028, 5.51093333004974, 7.0742951775901, 8.26439798949286, 
9.37338230921887, 9.5410633541178, 11.1611216005404, 12.378370850347, 
13.3905590295326, 14.0662804655731, 15.0935473444406, 15.8645145166665, 
16.8574128514156, 18.0914570542518, 19.3654514602385, 20.1805236600339
)
```

```{r}
# Plot the continuous_series using continuous time indexing
par(mfrow=c(2,1))
plot(continuous_time_index,continuous_series, type = "b")

# Make a discrete time index using 1:20 
discrete_time_index <- seq(1:20)

# Now plot the continuous_series using discrete time indexing
plot(discrete_time_index,continuous_series, type = "b")

```

## Sampling frequency

```{r, echo=FALSE}
AirPassengers<-structure(c(112, 118, 132, 129, 121, 135, 148, 148, 136, 119, 
104, 118, 115, 126, 141, 135, 125, 149, 170, 170, 158, 133, 114, 
140, 145, 150, 178, 163, 172, 178, 199, 199, 184, 162, 146, 166, 
171, 180, 193, 181, 183, 218, 230, 242, 209, 191, 172, 194, 196, 
196, 236, 235, 229, 243, 264, 272, 237, 211, 180, 201, 204, 188, 
235, 227, 234, 264, 302, 293, 259, 229, 203, 229, 242, 233, 267, 
269, 270, 315, 364, 347, 312, 274, 237, 278, 284, 277, 317, 313, 
318, 374, 413, 405, 355, 306, 271, 306, 315, 301, 356, 348, 355, 
422, 465, 467, 404, 347, 305, 336, 340, 318, 362, 348, 363, 435, 
491, 505, 404, 359, 310, 337, 360, 342, 406, 396, 420, 472, 548, 
559, 463, 407, 362, 405, 417, 391, 419, 461, 472, 535, 622, 606, 
508, 461, 390, 432), .Tsp = c(1949, 1960.91666666667, 12), class = "ts")
```

```{r}
# Plot AirPassengers
plot(AirPassengers)

# View the start and end dates of AirPassengers
start(AirPassengers)
end(AirPassengers)

# Use time(), deltat(), frequency(), and cycle() with AirPassengers 
time(AirPassengers)
deltat(AirPassengers)
frequency(AirPassengers)
cycle(AirPassengers)
```

## Missing values

Still working with the AirPassengers data, but now there are missing values.

```{r, echo=FALSE}
AirPassengers <- structure(c(112, 118, 132, 129, 121, 135, 148, 148, 136, 119, 
104, 118, 115, 126, 141, 135, 125, 149, 170, 170, 158, 133, 114, 
140, 145, 150, 178, 163, 172, 178, 199, 199, 184, 162, 146, 166, 
171, 180, 193, 181, 183, 218, 230, 242, 209, 191, 172, 194, 196, 
196, 236, 235, 229, 243, 264, 272, 237, 211, 180, 201, 204, 188, 
235, 227, 234, 264, 302, 293, 259, 229, 203, 229, 242, 233, 267, 
269, 270, 315, 364, 347, 312, 274, 237, 278, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, 315, 301, 356, 348, 355, 422, 
465, 467, 404, 347, 305, 336, 340, 318, 362, 348, 363, 435, 491, 
505, 404, 359, 310, 337, 360, 342, 406, 396, 420, 472, 548, 559, 
463, 407, 362, 405, 417, 391, 419, 461, 472, 535, 622, 606, 508, 
461, 390, 432), .Tsp = c(1949, 1960.91666666667, 12), class = "ts")
```

```{r}
# Plot the AirPassengers data
plot(AirPassengers)

# Compute the mean of AirPassengers
mean(AirPassengers, na.rm = TRUE)

# Impute mean values to NA in AirPassengers
AirPassengers[85:96] <- mean(AirPassengers, na.rm = TRUE)

# Generate another plot of AirPassengers
plot(AirPassengers)

# Add the complete AirPassengers data to your plot
rm(AirPassengers)
points(AirPassengers, type = "l", col = 2, lty = 3)
```

## Basic time series objects

```{r, echo=FALSE}
data_vector <- c(2.05219410731111, 4.29288527974091, 3.32941329441844, 3.50859506696045, 
0.000957693762193124, 1.92171863450249, 0.797813412800535, 0.299954343478063, 
0.943568753562609, 0.574828338758714, -0.00340059028674611, 0.34486491757086, 
2.22297611360904, 0.1763144576315, 2.70976227698024, 1.25019489653419, 
-0.400716475448651, 0.88527321208965, -1.5852420265539, -2.28292788910447, 
-2.56095312898444, -3.12599637544793, -2.86602958954692, -1.78470092068662, 
-1.88949129078692, -2.7255351193826, -2.10331418003627, -0.0174256893338487, 
-0.361320415116881, -2.90084033266105, -3.28474409267047, -2.8684594717709, 
-1.95050744365674, -4.88018925247303, -3.2634605352894, -1.63960625222554, 
-3.30125758402894, -2.63312454334943, -1.70583540221139, -2.21198250613255, 
-0.517059518572955, 0.0752508094841423, -0.840699471563585, -1.40226834874561, 
-0.138211423023857, -1.40659547028281, -2.3046941054804, 1.50738914324565, 
0.711867947688864, -1.13005190223045)
```

```{r}
# Use print() and plot() to view data_vector
print(data_vector)
plot(data_vector)

# Convert data_vector to a ts object with start = 2004 and frequency = 4
time_series <- ts(data_vector, start = 2004, frequency = 4)

# Use print() and plot() to view time_series
print(time_series)
plot(time_series) 
```

## Testing whether an object is a time series

```{r}
# Check whether Nile is a ts object
is.ts(Nile)
```

## Plotting a time series object

```{r}
eu_stocks <- EuStockMarkets

# Check whether eu_stocks is a ts object
is.ts(eu_stocks)

# View the start, end, and frequency of eu_stocks
start(eu_stocks)
end(eu_stocks)
frequency(eu_stocks)

# Generate a simple plot of eu_stocks
plot(eu_stocks)

# Use ts.plot with eu_stocks
ts.plot(eu_stocks, col = 1:4, xlab = "Year", ylab = "Index Value", main = "Major European Stock Indices, 1991-1998")

# Add a legend to your ts.plot
legend("topleft", colnames(eu_stocks), lty = 1, col = 1:4, bty = "n")
```


